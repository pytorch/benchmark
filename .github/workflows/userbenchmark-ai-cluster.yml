name: TorchBench Userbenchmark on AI Cluster
on:
  schedule:
    # on the AI cluster, the cron job runs at 8 PM UTC
    # we expect the result to be available at 10 PM UTC
    - cron: '0 22 * * *' # run at 10 PM UTC
  workflow_dispatch:
    inputs:
      userbenchmark_name:
        description: "Name of the user benchmark to run"
env:
  PYTHON_VERSION: "3.8"
  CONDA_ENV_NAME: "ai-cluster-ci"
jobs:
  collect-userbenchmark-result:
    runs-on: [linux.2xlarge] # a small instance is sufficient
    timeout-minutes: 60 # 1 hour
    steps:
      - name: Checkout TorchBench
        uses: actions/checkout@v2
        with:
          path: benchmark
      - name: Create conda environment
        run: |
          conda create -y -q --name "${CONDA_ENV_NAME}" python="${PYTHON_VERSION}"
      - name: Run AI Cluster benchmark
        run: |
          